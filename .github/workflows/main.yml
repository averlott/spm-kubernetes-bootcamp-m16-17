name: wf-test
on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - "Docker/**"
      - "Docker-compose/**"
env:
  DockerHub_UserName: ${{ secrets.DOCKERHUB_USERNAME }}
  DockerHub_Password: ${{ secrets.DOCKERHUB_TOKEN }}
  DockerHub_RepoName: spm-openjdk-bootcamp-m14
  DockerHub_TagName: github_m16-17
  Docker_ContainerTag: m16-17
  Application_Original_Port: 3456
  Application_Expose_Port: 8001

jobs:
  test-job:
    runs-on: ubuntu-latest
    steps:
    
      - name: Concatena variables para reutilizar las existentes y crear otras
        run: |
          echo "Docker_ContainerName=${{env.DockerHub_RepoName}}_${{env.Docker_ContainerTag}}" >> $GITHUB_ENV
          
      - name: Checkout codigo del repositorio
        uses: actions/checkout@v3
        
      - uses: docker/build-push-action@v2
        with:
          file: Docker/Dockerfile
          build-args: -p ${{env.Application_Expose_Port}}:${{env.Application_Original_Port}}
          tags: ${{env.DockerHub_UserName}}/${{env.DockerHub_RepoName}}:${{env.DockerHub_TagName}}_51
          push: false
          
      - uses: addnab/docker-run-action@v3
        with:
          image: ${{env.DockerHub_UserName}}/${{env.DockerHub_RepoName}}:${{env.DockerHub_TagName}}_51
          run: curl "localhost:3456"

      - uses: addnab/docker-run-action@v3
        with:
          image: ${{env.DockerHub_UserName}}/${{env.DockerHub_RepoName}}:${{env.DockerHub_TagName}}_51
          shell: bash
          run: |
            echo "first line"
            curl localhost:8001
